{% extends 'main.html' %}
{% block content %}

    <div class="main">
        <div class="sidenav" style="float: left;">
            <select id="select-college">
                {% for college in colleges %}
                    <option class="college" id="{{ college }}" onclick="function1({{ college }})">{{ college }}</option>
                {% endfor %}
            </select>
            <br/><br/><br/><br/><br/>
            <ul id="course-list">

            </ul>
            <br/><br/><br/><br/><br/>
            <div class="temporary-list" id="temporary-list" style="">

            </div>
        </div>

        <div class="hours" id="hours">
        </div>

        <div class="main-table">
            <figure class="square thu">پنج شنبه</figure><figure class="square wed">چهارشنبه</figure><figure class="square tue">سه شنبه</figure><figure class="square mon">دوشنبه</figure><figure class="square sun">یک شنبه</figure><figure class="square sat">شنبه</figure>
            <div id="main-table">

            </div>
        </div>

    </div>

        <script type="text/javascript">

            function function1(rawCollege){
                let url = "http://127.0.0.1:8000/api/course-list/";
                fetch(url).then((response) => response.json())
                    .then(function(data){
                        let courseList = document.getElementById("course-list")

                        let college = rawCollege.innerHTML
                        let item = "";
                        if(college == 'برق'){
                            courseList.innerHTML = "";
                            for(let i in data){
                                if(3 == data[i].college){
                                    item = data[i].title;
                                    console.log(data[i].id)
                                    courseList.innerHTML += `<li id="${data[i].id}" onmouseover="function3(${ data[i].code },${ data[i].title },${ data[i].professor },${ data[i].ws },${ data[i].unit },${ data[i].group },${ data[i].examDate })" onmouseout="function4()" onclick="function2(${ data[i].id })">${ item }</li>`
                                }
                            }
                        }else if(college == "ریاضی"){
                            courseList.innerHTML = "";
                            for(let i in data){
                                if(6 == data[i].college){
                                    item = data[i].title;
                                    courseList.innerHTML += `<li onclick="function2(${ data[i].id })">${ item }</li>`
                                }
                            }
                        }else if(college == "cs"){
                            courseList.innerHTML = "";
                            for(let i in data){
                                if(8 == data[i].college){
                                    item = data[i].title;
                                    courseList.innerHTML += `<li onclick="function2(${ data[i].id })">${ item }</li>`
                                }
                            }
                        }else if(college == "عمران"){
                            courseList.innerHTML = "";
                            for(let i in data){
                                if(5 == data[i].college){
                                    item = data[i].title;
                                    courseList.innerHTML += `<li onclick="function2(${ data[i].id })">${ item }</li>`
                                }
                            }
                        }else if(college == "فیزیک"){
                            courseList.innerHTML = "";
                            for(let i in data){
                                if(2 == data[i].college){
                                    item = data[i].title;
                                    courseList.innerHTML += `<li onclick="function2(${ data[i].id })">${ item }</li>`
                                }
                            }
                        }else if(college ==  "ce"){
                            courseList.innerHTML = "";
                            for(let i in data){
                                if(7 == data[i].college){
                                    item = data[i].title;
                                    courseList.innerHTML += `<li onclick="function2(${ data[i].id })">${ item }</li>`
                                }
                            }
                        }else if(college == "مکانیک"){
                            courseList.innerHTML = "";
                            for(let i in data){
                                if(4 == data[i].college){
                                    item = data[i].title;
                                    courseList.innerHTML += `<li onclick="function2(${ data[i].id })">${ item }</li>`
                                }
                            }
                        }else if(college == "میمشیمی"){
                            courseList.innerHTML = "";
                            for(let i in data){
                                if(9 == data[i].college){
                                    item = data[i].title;
                                    courseList.innerHTML += `<li onclick="function2(${ data[i].id })">${ item }</li>`
                                }
                            }
                        }else if(college == "هوافضا"){
                            courseList.innerHTML = "";
                            for(let i in data){
                                if(1 == data[i].college){
                                    item = data[i].title;
                                    courseList.innerHTML += `<li onclick="function2(${ data[i].id })">${ item }</li>`
                                }
                            }
                        }else if(college == "نفت"){
                            courseList.innerHTML = "";
                            for(let i in data){
                                if(10 == data[i].college){
                                    item = data[i].title;
                                    courseList.innerHTML += `<li onclick="function2(${ data[i].id })">${ item }</li>`
                                }
                            }
                        }else(console.log(college))

                    })
             }

            for(let j = 7; j < 21; j++){
                document.getElementById("hours").innerHTML += `<p>${ j }</p>`
            }

            function function2(courseId){
                Promise.all([
                    fetch("http://127.0.0.1:8000/api/course-list/").then(resp => resp.json()),
                    fetch("http://127.0.0.1:8000/api/ws-list/").then(resp => resp.json()),
                ]).then(function(data){
                    let listOfCourses = data[0];
                    let listOfWS = data[1];
                    let mainTable = document.getElementById("main-table")
                    let wsId;
                    for(let i in listOfCourses){
                    if(courseId == listOfCourses[i].id){
                        wsId = listOfCourses[i].ws;
                        for(let j in listOfWS){
                            if(wsId == listOfWS[j].id){
                                let day1 = listOfWS[j].day1;
                                let day2 = listOfWS[j].day2;
                                let start = listOfWS[j].start;
                                let time = listOfWS[j].time;
                                let height = 75 * time
                                let right1 = 271 * day1
                                let right2 = 271 * day2
                                let top = (start - 7) * 66.6 + 29
                                mainTable.innerHTML +=
                                    `<div>
                                        <div class="course square" style="height: ${height}px;
                                            top: ${top}px;
                                            right: ${right1}px;">
                                            <figure class="">
                                                ${listOfCourses[i].code}<br>
                                                <strong>${listOfCourses[i].title}</strong><br>
                                                ${listOfCourses[i].professor}
                                            </figure>
                                        </div>
                                        <div class="course square" style="height: ${height}px;
                                            top: ${top}px;
                                            right: ${right2}px;">
                                            <figure class="">
                                                ${listOfCourses[i].code}<br>
                                                <strong>${listOfCourses[i].title}</strong><br>
                                                ${listOfCourses[i].professor}
                                            </figure>
                                        </div>
                                    </div>`
                            }
                        }
                    }else if(courseId == 0){
                        mainTable.innerHTML = ''
                    }


                }
                })
            }


            function function3(code, title, professor, ws, unit, group, examDate){
                document.getElementById("temporary-list").innerHTML = `<ul>
                                                                            <li>${code}</li>
                                                                            <li>${title}</li>
                                                                            <li>${professor}</li>
                                                                            <li>${ws}</li>
                                                                            <li>${unit}</li>
                                                                            <li>${group}</li>
                                                                            <li>${examDate}</li>
                                                                       <ul>`
             }
            function function4(){
                document.getElementById("temporary-list").innerHTML = ''
             }

        </script>



{% endblock content %}